---
title: "Illustrative case study 2"
author: "Thomas Debray"
date: "This report was generated on `r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---


```{r setup, include=FALSE}
# Set document properties
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)

source("../R/functions.r")

library(table1)
library(ggplot2)
```


```{r}
################################################################################
# Prepare data
################################################################################
d <- read.csv("F:/OneDrive Smart Data/OneDrive - Smart Data Analysis and Statistics/Research/Manuscripts/Long - PGS weighting/data/RCT_IST.csv")

dat <- data.frame(HOSPNUM = d$HOSPNUM,
                  OCCODE = d$OCCODE,
                  RXASP = d$RXASP,
                  RXHEP = d$RXHEP,
                  RDELAY = d$RDELAY,
                  AGE = d$AGE,
                  SEX = d$SEX,
                  RSLEEP = d$RSLEEP,
                  RCONSC = d$RCONSC,
                  RATRIAL = d$RATRIAL,
                  RSBP = d$RSBP,
                  STYPE = d$STYPE,
                  RDEF1 = d$RDEF1,
                  RDEF2 = d$RDEF2,
                  RDEF3 = d$RDEF3,
                  RDEF4 = d$RDEF4,
                  RDEF5 = d$RDEF5,
                  RDEF6 = d$RDEF6,
                  RDEF7 = d$RDEF7,
                  RDEF8 = d$RDEF8,
                  RVISINF = d$RVISINF,
                  RCT = d$RCT,
                  RASP3 = d$RASP3,
                  RHEP24 = d$RHEP24,
                  EXPDD = d$EXPDD)
```

We reanalysed the International Stroke Trial (IST). The IST was a large, multi-center, randomized, placebo-controlled trial including `r nrow(dat)` stroke patients. The IST evaluated the effect of Aspirin on a primary composite outcome of death or dependency (i.e. absence of autonomy) at 6 months (binary outcome). In this illustrative case study, we focus on `r nrow(subset(dat, RXASP == "Y"))` patients that were randomized to receive aspirin.


```{r}
##complete case on OCCODE
dat[dat$OCCODE == 9 | dat$OCCODE == 0,]$OCCODE <- NA

# codage
dat$outcome <- ifelse(dat$OCCODE == 1 | dat$OCCODE == 2, 1, 0)
dat$ASP <- ifelse(dat$RXASP == "Y", 1, 0)
dat$HEP <- ifelse(dat$RXHEP == "N", 0, 1)

# NA
#984  RASP3
dat$ASP3 <- ifelse(dat$RASP3 == "Y", 1, ifelse(dat$RASP3 == "N", 0, NA))

# 344 HEP24
dat$HEP24 <- ifelse(dat$RHEP24 == "Y", 1, ifelse(dat$RHEP24 == "N", 0, NA))

# 984 RATRIAL
dat$ATRIAL <- ifelse(dat$RATRIAL == "Y", 1, ifelse(dat$RATRIAL == "N", 0, NA))


dat <- dat[dat$ASP == 1,]
dat <- dat[complete.cases(dat),]
dat$a <- ifelse(dat$RDELAY <= 8, 1, 0)
dat$y <- dat$outcome

```

Amongst patients enrolled in the Aspirin arm of the International Stroke Trial, less than a quarter received the treatment between 0 and 8 hours following the onset of symptoms (23.6%, 2 161). In this group, 1443 (66.8%) patients were recorded with death or dependency at 6 months versus 4248 (60.8%) in the group of patients who received Aspirin later (after 8 hours).


We here consider the following baseline covariates (some of which were imputed):

```{r}
table1(~ HOSPNUM + OCCODE + RXASP | a, 
       data = dat, 
       caption = "Baseline characteristics.")
```

